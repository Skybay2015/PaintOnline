(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{34:function(t,e,s){},41:function(t,e,s){},42:function(t,e,s){},43:function(t,e,s){"use strict";s.r(e);var n=s(0),i=s.n(n),o=s(14),a=s.n(o),c=s(29),r=s(18),h=(s(34),s(8)),l=s(9),u=s(5),d=new(function(){function t(){Object(h.a)(this,t),this.canvas=null,this.undoList=[],this.redoList=[],this.username="",Object(u.d)(this)}return Object(l.a)(t,[{key:"setUsername",value:function(t){this.username=t}},{key:"setCanvas",value:function(t){this.canvas=t}},{key:"pushToUndo",value:function(t){this.undoList.push(t)}},{key:"pushToRedo",value:function(t){this.redoList.push(t)}},{key:"undo",value:function(t,e){var s=this.canvas.getContext("2d");if(this.undoList.length>0){var n=this.undoList.pop();this.redoList.push(this.canvas.toDataURL()),t.send(JSON.stringify({method:"picture",id:e,data:{url:n}}))}else s.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"redo",value:function(t,e){if(this.redoList.length>0){var s=this.redoList.pop();this.undoList.push(this.canvas.toDataURL()),t.send(JSON.stringify({method:"picture",id:e,data:{url:s}}))}}}]),t}()),f=new(function(){function t(){Object(h.a)(this,t),this.tool=null,this.mainColor="#000",this.strokeColor="#000",this.lineWidth=1,Object(u.d)(this)}return Object(l.a)(t,[{key:"setTool",value:function(t){this.tool=t}},{key:"setFillColor",value:function(t){this.tool.fillColor=t,this.mainColor=t}},{key:"setStrokeColor",value:function(t){this.tool.stokeColor=t,this.strokeColor=t}},{key:"setLineWidth",value:function(t){this.tool.lineWidth=t,this.lineWidth=t}}]),t}()),v=s(17),b=s(16),m=function(){function t(e,s,n){Object(h.a)(this,t),this.canvas=e,this.socket=s,this.id=n,this.ctx=e.getContext("2d"),this.destroyEvents()}return Object(l.a)(t,[{key:"fillColor",set:function(t){this.ctx.fillStyle=t}},{key:"stokeColor",set:function(t){this.ctx.strokeStyle=t}},{key:"lineWidth",set:function(t){this.ctx.lineWidth=t}},{key:"destroyEvents",value:function(){this.canvas.onmousemove=null,this.canvas.onmousedown=null,this.canvas.onmouseup=null}}]),t}(),g=function(t){Object(v.a)(s,t);var e=Object(b.a)(s);function s(t,n,i){var o;return Object(h.a)(this,s),(o=e.call(this,t,n,i)).listen(),o}return Object(l.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"finish"}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"brush",x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop,color:this.ctx.fillStyle,lineWidth:this.ctx.lineWidth}}))}}],[{key:"draw",value:function(t,e,s,n,i){console.log("draw",n),t.strokeStyle=n,t.lineWidth=i,t.lineTo(e,s),t.stroke()}}]),s}(m),j=s(46),k=s(47),x=s(1),w=function(t){var e=t.modal,s=t.usernameRef,n=t.connectionHandler;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)(j.a,{show:e,children:[Object(x.jsx)(j.a.Header,{children:Object(x.jsx)(j.a.Title,{children:"Enter your name"})}),Object(x.jsx)(j.a.Body,{children:Object(x.jsx)("input",{ref:s,type:"text"})}),Object(x.jsx)(j.a.Footer,{children:Object(x.jsx)(k.a,{variant:"secondary",onClick:n,children:"Enter"})})]})})},y=s(6),O=new(function(){function t(){Object(h.a)(this,t),this.sessionId=null,this.socket=null,Object(u.d)(this)}return Object(l.a)(t,[{key:"setSessionId",value:function(t){this.sessionId=t}},{key:"setSocket",value:function(t){console.log(t,"setSocket"),this.socket=t}}]),t}()),p=function(t){Object(v.a)(s,t);var e=Object(b.a)(s);function s(t,n,i){var o;return Object(h.a)(this,s),(o=e.call(this,t,n,i)).listen(),o}return Object(l.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"rect",x:this.startX,y:this.startY,width:this.width,height:this.height,color:this.ctx.fillStyle,strokeColor:this.ctx.strokeStyle,lineWidth:this.ctx.lineWidth}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,s=t.pageY-t.target.offsetTop;this.width=e-this.startX,this.height=s-this.startY,this.draw(this.startX,this.startY,this.width,this.height)}}},{key:"draw",value:function(t,e,s,n){var i=this,o=new Image;o.src=this.saved,o.onload=function(){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.ctx.drawImage(o,0,0,i.canvas.width,i.canvas.height),i.ctx.beginPath(),i.ctx.rect(t,e,s,n),i.ctx.fill(),i.ctx.stroke()},this.ctx.rect(t,e,s,n),this.ctx.fill(),this.ctx.stroke()}}],[{key:"staticDraw",value:function(t,e,s,n,i,o,a,c){t.fillStyle=o,t.strokeStyle=a,t.lineWidth=c,t.beginPath(),t.rect(e,s,n,i),t.fill(),t.stroke()}}]),s}(m),C=function(t){Object(v.a)(s,t);var e=Object(b.a)(s);function s(t,n,i){var o;return Object(h.a)(this,s),(o=e.call(this,t,n,i)).listen(),o}return Object(l.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"circle",x:this.startX,y:this.startY,r:this.r,width:this.width,height:this.height,color:this.ctx.fillStyle,strokeColor:this.ctx.strokeStyle,lineWidth:this.ctx.lineWidth}}))}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHandler",value:function(t){if(this.mouseDown){var e=t.pageX-t.target.offsetLeft,s=t.pageY-t.target.offsetTop;this.width=e-this.startX,this.height=s-this.startY,this.r=Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2)),this.draw(this.startX,this.startY,this.r)}}},{key:"draw",value:function(t,e,s){var n=this,i=new Image;i.src=this.saved,i.onload=function(){n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height),n.ctx.drawImage(i,0,0,n.canvas.width,n.canvas.height),n.ctx.beginPath(),n.ctx.arc(t,e,s,2*Math.PI,!1),n.ctx.fill(),n.ctx.stroke()},this.ctx.arc(t,e,s,2*Math.PI,!1),this.ctx.fill(),this.ctx.stroke()}}],[{key:"staticDraw",value:function(t,e,s,n,i,o,a){t.fillStyle=i,t.lineWidth=a,t.strokeStyle=o,t.beginPath(),t.arc(e,s,n,2*Math.PI,!1),t.fill(),t.stroke()}}]),s}(m),S=function(t){Object(v.a)(s,t);var e=Object(b.a)(s);function s(t,n,i){var o;return Object(h.a)(this,s),(o=e.call(this,t,n,i)).listen(),o}return Object(l.a)(s,[{key:"listen",value:function(){this.canvas.onmousemove=this.mouseMoveHandler.bind(this),this.canvas.onmousedown=this.mouseDownHandler.bind(this),this.canvas.onmouseup=this.mouseUpHandler.bind(this)}},{key:"mouseDownHandler",value:function(t){this.mouseDown=!0,this.currentX=t.pageX-t.target.offsetLeft,this.currentY=t.pageY-t.target.offsetTop,this.ctx.beginPath(),this.ctx.moveTo(this.currentX,this.currentY),this.saved=this.canvas.toDataURL()}},{key:"mouseUpHandler",value:function(t){this.mouseDown=!1,this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"line",currentX:this.currentX,currentY:this.currentY,x:this.x,y:this.y,color:this.ctx.fillStyle,lineWidth:this.ctx.lineWidth}}))}},{key:"mouseMoveHandler",value:function(t){this.mouseDown&&(this.x=t.pageX-t.target.offsetLeft,this.y=t.pageY-t.target.offsetTop,this.draw(this.x,this.y))}},{key:"draw",value:function(t,e){var s=this,n=new Image;n.src=this.saved,n.onload=function(){s.ctx.clearRect(0,0,s.canvas.width,s.canvas.height),s.ctx.drawImage(n,0,0,s.canvas.width,s.canvas.height),s.ctx.beginPath(),s.ctx.moveTo(s.currentX,s.currentY),s.ctx.lineTo(t,e),s.ctx.stroke()}}}],[{key:"staticDraw",value:function(t,e,s,n,i,o,a){t.strokeStyle=o,t.lineWidth=a,t.beginPath(),t.moveTo(e,s),t.lineTo(n,i),t.stroke()}}]),s}(m),D=Object(r.a)((function(){var t=Object(y.g)().id,e=Object(n.useRef)(),s=Object(n.useRef)(),i=Object(n.useState)(!0),o=Object(c.a)(i,2),a=o[0],r=o[1];Object(n.useEffect)((function(){d.setCanvas(e.current)}),[]),Object(n.useEffect)((function(){if(d.username){var s=new WebSocket("ws://localhost:5000/");O.setSocket(s),O.setSessionId(t),f.setTool(new g(e.current,s,t)),s.onopen=function(){s.send(JSON.stringify({id:t,username:d.username,method:"connection"}))},s.onmessage=function(t){var e=JSON.parse(t.data);switch(console.log(e.method),e.method){case"connection":console.log("user ".concat(e.username));break;case"picture":l(e);break;case"draw":u(e)}}}}),[d.username]);var h=function(t,e,s){f.setFillColor(t),f.setStrokeColor(e),f.setLineWidth(s)},l=function(t){var s=t.data.url,n=e.current.getContext("2d"),i=new Image;i.src=s,i.onload=function(){n.clearRect(0,0,e.current.width,e.current.height),n.drawImage(i,0,0,e.current.width,e.current.height)}},u=function(t){var s=t.figure,n=e.current.getContext("2d"),i=f.mainColor,o=f.strokeColor,a=f.lineWidth;switch(s.type){case"brush":g.draw(n,s.x,s.y,s.color,s.lineWidth);break;case"rect":p.staticDraw(n,s.x,s.y,s.width,s.height,s.color,s.strokeColor,s.lineWidth),h(i,o,a),n.beginPath();break;case"circle":C.staticDraw(n,s.x,s.y,s.r,s.color,s.strokeColor,s.lineWidth),h(i,o,a),n.beginPath();break;case"line":S.staticDraw(n,s.currentX,s.currentY,s.x,s.y,s.color,s.lineWidth),h(i,o,a),n.beginPath();break;case"finish":n.beginPath(),h(i,o,a)}};return Object(x.jsxs)("div",{className:"canvas",children:[Object(x.jsx)(w,{connectionHandler:function(){d.setUsername(s.current.value),r(!1)},modal:a,usernameRef:s}),Object(x.jsx)("canvas",{onMouseDown:function(){d.pushToUndo(e.current.toDataURL())},ref:e,width:900,height:500})]})})),L=function(){return Object(x.jsxs)("div",{className:"settingsbar",children:[Object(x.jsx)("label",{htmlFor:"line-width",children:"Line width"}),Object(x.jsx)("input",{onChange:function(t){return f.setLineWidth(t.target.value)},id:"line-width",type:"number",style:{margin:"0 16px"},defaultValue:1,min:1,max:50}),Object(x.jsx)("label",{htmlFor:"stroke-color",children:"Stroke color"}),Object(x.jsx)("input",{onChange:function(t){return f.setStrokeColor(t.target.value)},id:"stroke-color",type:"color",style:{margin:"0 16px"},defaultValue:1,min:1,max:50})]})},H=(s(41),function(t){Object(v.a)(s,t);var e=Object(b.a)(s);function s(t){return Object(h.a)(this,s),e.call(this,t)}return Object(l.a)(s,[{key:"draw",value:function(t,e){this.ctx.strokeStyle="white",this.ctx.lineTo(t,e),this.ctx.stroke()}}]),s}(g)),T=Object(r.a)((function(){return Object(x.jsxs)("div",{className:"toolbar",children:[Object(x.jsx)("button",{className:"toolbar__btn brush",onClick:function(){return f.setTool(new g(d.canvas,O.socket,O.sessionId))}}),Object(x.jsx)("button",{className:"toolbar__btn rect",onClick:function(){return f.setTool(new p(d.canvas,O.socket,O.sessionId))}}),Object(x.jsx)("button",{className:"toolbar__btn circle",onClick:function(){return f.setTool(new C(d.canvas,O.socket,O.sessionId))}}),Object(x.jsx)("button",{className:"toolbar__btn eraser",onClick:function(){return f.setTool(new H(d.canvas))}}),Object(x.jsx)("button",{className:"toolbar__btn line",onClick:function(){return f.setTool(new S(d.canvas,O.socket,O.sessionId))}}),Object(x.jsx)("input",{onChange:function(t){f.setFillColor(t.target.value),f.setStrokeColor(t.target.value)},type:"color"}),Object(x.jsx)("button",{className:"toolbar__btn undo",onClick:function(){return d.undo(O.socket,O.sessionId)}}),Object(x.jsx)("button",{className:"toolbar__btn redo",onClick:function(){return d.redo(O.socket,O.sessionId)}}),Object(x.jsx)("button",{className:"toolbar__btn save"})]})})),W=s(22);s(42);var I=function(){return Object(x.jsx)(W.a,{children:Object(x.jsx)("div",{className:"app",children:Object(x.jsxs)(y.d,{children:[Object(x.jsxs)(y.b,{path:"/:id",children:[Object(x.jsx)(T,{}),Object(x.jsx)(L,{}),Object(x.jsx)(D,{})]}),Object(x.jsx)(y.a,{to:"f".concat((+new Date).toString(16))})]})})})};a.a.render(Object(x.jsx)(i.a.StrictMode,{children:Object(x.jsx)(I,{})}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.0340a82a.chunk.js.map